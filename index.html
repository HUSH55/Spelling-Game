<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Spelling Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f8ff;
      padding: 2rem;
      max-width: 600px;
      margin: auto;
    }
    input, button {
      font-size: 1.2rem;
      padding: 0.5rem;
      margin: 0.5rem 0;
    }
    #game-section {
      margin-top: 2rem;
    }
    #result {
      margin-top: 1rem;
      font-weight: bold;
      min-height: 1.5rem;
    }
    #struggle-list {
      margin-top: 1rem;
      display: none;
      background: #fff9c4;
      border: 1px solid #fbc02d;
      padding: 1rem;
      max-height: 150px;
      overflow-y: auto;
    }
    #pause-btn {
      margin-left: 1rem;
    }
  </style>
</head>
<body>
  <h1>Smart Spelling Game</h1>

  <div id="login-section">
    <input type="text" id="username" placeholder="Enter username" />
    <input type="password" id="pin" placeholder="Enter PIN" />
    <button onclick="login()">Login / Register</button>
    <div id="login-message" style="color: red; margin-top: 0.5rem;"></div>
  </div>

  <div id="game-section" style="display:none;">
    <p>Type the word you hear:</p>
    <button id="play-btn" onclick="playWord()">üîä Play Word</button>
    <input type="text" id="input" autocomplete="off" />
    <button onclick="checkAnswer()">Submit</button>
    <button id="pause-btn" onclick="togglePause()">Pause</button>
    <div id="result"></div>
    <div id="struggle-list">
      <strong>Words you struggle with most:</strong>
      <ul id="struggle-ul"></ul>
    </div>
  </div>

  <script>
    // Sample word list - extend as you want
    const WORDS = [
      "cat", "dog", "sun", "tree", "fish", "planet", "market", "family", "library", "bottle",
      "entrepreneur", "satellite", "architecture", "opportunity", "innovation", "achievement",
      "development", "education", "technology", "environment", "dictionary", "government"
    ];

    let currentUser = null;
    let userData = null;
    let currentWord = "";
    let paused = false;

    // Load or create user data from localStorage
    function loadUserData(username, pin) {
      const saved = localStorage.getItem("spelling-users");
      let users = saved ? JSON.parse(saved) : {};
      if (users[username]) {
        if (users[username].pin === pin) {
          return users[username];
        } else {
          return null; // wrong pin
        }
      }
      // new user
      users[username] = {
        pin: pin,
        mistakes: {},
        mastered: []
      };
      localStorage.setItem("spelling-users", JSON.stringify(users));
      return users[username];
    }

    // Save user data back to localStorage
    function saveUserData() {
      const saved = localStorage.getItem("spelling-users");
      let users = saved ? JSON.parse(saved) : {};
      users[currentUser] = userData;
      localStorage.setItem("spelling-users", JSON.stringify(users));
    }

    function login() {
      const username = document.getElementById("username").value.trim().toLowerCase();
      const pin = document.getElementById("pin").value.trim();
      const message = document.getElementById("login-message");
      message.textContent = "";
      if (!username || !pin) {
        message.textContent = "Please enter username and PIN.";
        return;
      }
      const data = loadUserData(username, pin);
      if (data === null) {
        message.textContent = "Incorrect PIN for this username.";
        return;
      }
      currentUser = username;
      userData = data;
      document.getElementById("login-section").style.display = "none";
      document.getElementById("game-section").style.display = "block";
      document.getElementById("input").focus();
      playWord();
    }

    function getNextWord() {
      // Filter out mastered words
      const candidates = WORDS.filter(w => !userData.mastered.includes(w));
      if (candidates.length === 0) {
        return null; // All mastered
      }
      // Randomly pick from candidates
      return candidates[Math.floor(Math.random() * candidates.length)];
    }

    function speakWord(word) {
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(word);
        utterance.lang = 'en-GB';
        utterance.rate = 0.6;  // slower rate for clarity
        utterance.pitch = 1.2; // slightly higher pitch
        speechSynthesis.speak(utterance);
      } else {
        alert("Speech synthesis not supported in this browser.");
      }
    }

    function playWord() {
      if (paused) return;
      currentWord = getNextWord();
      if (!currentWord) {
        document.getElementById("result").textContent = "üéâ You have mastered all words!";
        return;
      }
      speakWord(currentWord);
      document.getElementById("input").value = "";
      document.getElementById("result").textContent = "";
    }

    function checkAnswer() {
      if (paused) return;
      const input = document.getElementById("input").value.trim().toLowerCase();
      if (!currentWord) return;
      if (input === currentWord.toLowerCase()) {
        document.getElementById("result").textContent = "‚úÖ Correct!";
        // Remove word from mistakes (reset if mastered)
        delete userData.mistakes[currentWord];
        if (!userData.mastered.includes(currentWord)) {
          userData.mastered.push(currentWord);
        }
        saveUserData();
        setTimeout(playWord, 1500);
      } else {
        document.getElementById("result").textContent = `‚ùå Incorrect. Try again.`;
        // Track mistake count
        userData.mistakes[currentWord] = (userData.mistakes[currentWord] || 0) + 1;
        saveUserData();
      }
    }

    function togglePause() {
      paused = !paused;
      const btn = document.getElementById("pause-btn");
      if (paused) {
        btn.textContent = "Resume";
        showStruggleWords();
      } else {
        btn.textContent = "Pause";
        document.getElementById("struggle-list").style.display = "none";
        document.getElementById("result").textContent = "";
        playWord();
      }
    }

    function showStruggleWords() {
      const struggleDiv = document.getElementById("struggle-list");
      const struggleUl = document.getElementById("struggle-ul");
      struggleUl.innerHTML = "";
      let words = Object.entries(userData.mistakes);
      if (words.length === 0) {
        struggleUl.innerHTML = "<li>None yet! Keep playing.</li>";
      } else {
        words.sort((a, b) => b[1] - a[1]); // sort desc by mistakes
        words.forEach(([word, count]) => {
          let li = document.createElement("li");
          li.textContent = `${word} ‚Äî mistakes: ${count}`;
          struggleUl.appendChild(li);
        });
      }
      struggleDiv.style.display = "block";
    }

    // Add Enter key listener on the input box to submit answer
    document.getElementById("input").addEventListener("keydown", function(event) {
      if (event.key === "Enter") {
        event.preventDefault(); // prevent form submission if any
        checkAnswer();
      }
    });
  </script>
</body>
</html>
