<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SpellMaster 3000</title>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZW0H1N3TDY"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-ZW0H1N3TDY');
  </script>

  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    .hidden { display: none; }
    .correct { color: green; animation: bounce 0.5s; }
    .incorrect { color: red; animation: shake 0.3s; }
    @keyframes bounce {
      0% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
  </style>
</head>
<body>

  <h1>SpellMaster 3000 🔤</h1>
  <p><strong>Word:</strong> <span id="currentWord">🎧 Listen and Spell</span></p>
  <input type="text" id="answerInput" placeholder="Type here..." autofocus />
  <button onclick="checkAnswer()">Submit</button>
  <p id="feedback"></p>

  <hr>

  <p>XP: <span id="xp">0</span> | Level: <span id="level">1</span> | Streak: <span id="streak">0</span></p>
  <p>Bonus Word: <span id="bonusWordDisplay">Loading...</span></p>

  <hr>

  <button onclick="playWord()">🔊 Hear Word Again</button>
  <select id="voiceSelect"></select>

  <hr>

  <h3>Achievements 🏅</h3>
  <ul id="achievements"></ul>

  <h3>Top 5 Local Scores 🏆</h3>
  <ol id="leaderboard"></ol>

  <h3>Goblin Says:</h3>
  <p id="goblin">I’m watching your spelling skills... 👀</p>

  <script>
    const words = ["apple", "banana", "cherry", "dragon", "elephant", "falcon", "goblin", "helmet", "island", "jungle"];
    let currentWord = "";
    let bonusWord = "";
    let userData = JSON.parse(localStorage.getItem("userData") || "{}");
    let synth = window.speechSynthesis;
    let voices = [];

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      const selectedVoice = document.getElementById("voiceSelect").value;
      utterance.voice = voices.find(v => v.name === selectedVoice);
      synth.speak(utterance);
    }

    function getRandomWord() {
      return words[Math.floor(Math.random() * words.length)];
    }

    function updateStatsDisplay() {
      document.getElementById("xp").textContent = userData.xp || 0;
      document.getElementById("level").textContent = userData.level || 1;
      document.getElementById("streak").textContent = userData.streak || 0;
    }

    function updateLeaderboard() {
      const scores = JSON.parse(localStorage.getItem("leaderboard") || "[]");
      scores.sort((a, b) => b.xp - a.xp);
      const top5 = scores.slice(0, 5);
      document.getElementById("leaderboard").innerHTML = top5.map(s => `<li>${s.name || "Player"} - ${s.xp} XP</li>`).join("");
    }

    function unlockAchievements() {
      const list = [];
      if ((userData.totalCorrect || 0) >= 5) list.push("🎯 Flawless 5");
      if ((userData.totalCorrect || 0) >= 20) list.push("💡 Spelling Guru");
      if ((userData.streak || 0) >= 10) list.push("🔥 10 Streak Master");

      document.getElementById("achievements").innerHTML = list.map(a => `<li>${a}</li>`).join("");
    }

    function updateBonusWord() {
      const today = new Date().toDateString();
      if (userData.lastBonusDay !== today) {
        bonusWord = getRandomWord();
        userData.lastBonusDay = today;
        userData.bonusWord = bonusWord;
      } else {
        bonusWord = userData.bonusWord;
      }
      document.getElementById("bonusWordDisplay").textContent = bonusWord;
    }

    function saveUserData() {
      localStorage.setItem("userData", JSON.stringify(userData));
    }

    function playWord() {
      speak(currentWord);
    }

    function pickNewWord() {
      currentWord = getRandomWord();
      playWord();
    }

    function updateGoblinFeedback(success) {
      const phrases = success
        ? ["Not bad, human.", "Impressive!", "You're smarter than you look."]
        : ["Wrong again? Tsk tsk...", "Even my goblin cousin could do better!", "I expected more from you!"];
      document.getElementById("goblin").textContent = phrases[Math.floor(Math.random() * phrases.length)];
    }

    function checkAnswer() {
      const input = document.getElementById("answerInput").value.toLowerCase().trim();
      const feedback = document.getElementById("feedback");

      if (!userData.wordStats) userData.wordStats = {};
      userData.wordStats[currentWord] = userData.wordStats[currentWord] || { correct: 0, total: 0 };
      userData.wordStats[currentWord].total++;

      if (input === currentWord) {
        feedback.textContent = "✅ Correct!";
        feedback.className = "correct";
        userData.totalCorrect = (userData.totalCorrect || 0) + 1;
        userData.streak = (userData.streak || 0) + 1;
        let points = 5;
        if (currentWord === bonusWord) points *= 2;
        userData.xp = (userData.xp || 0) + points;
        userData.level = Math.floor(userData.xp / 50) + 1;
        userData.wordStats[currentWord].correct++;
      } else {
        feedback.textContent = "❌ Try Again!";
        feedback.className = "incorrect";
        userData.streak = 0;
      }

      updateGoblinFeedback(input === currentWord);
      updateStatsDisplay();
      unlockAchievements();
      saveUserData();

      document.getElementById("answerInput").value = "";
      setTimeout(pickNewWord, 1000);

      // Save to leaderboard
      let scores = JSON.parse(localStorage.getItem("leaderboard") || "[]");
      scores.push({ name: "You", xp: userData.xp || 0 });
      localStorage.setItem("leaderboard", JSON.stringify(scores));
      updateLeaderboard();
    }

    function populateVoiceList() {
      voices = synth.getVoices();
      const voiceSelect = document.getElementById("voiceSelect");
      voiceSelect.innerHTML = voices.map(v => `<option>${v.name}</option>`).join("");
    }

    // Load everything
    window.onload = function () {
      populateVoiceList();
      synth.onvoiceschanged = populateVoiceList;
      userData.xp ||= 0;
      userData.level ||= 1;
      userData.streak ||= 0;
      updateBonusWord();
      updateStatsDisplay();
      unlockAchievements();
      updateLeaderboard();
      pickNewWord();
    };
  </script>

</body>
</html>
